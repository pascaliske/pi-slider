!function(a){a.fn.piSlider=function(e){function r(r){e.startImage?a(".images, .images img:eq("+v+")").fadeIn("400"):a(".images, .images img:eq("+b+")").fadeIn("400"),r.append(u),a(".controls").fadeIn(300),e.arrows&&a(".controls").prepend(l.left).append(l.right),e.progressBar&&(a(".controls").append(f),a(".progressbar").css("background-color",e.progressColor),"top"===e.progressPosition&&a(".progressbar").css({top:"0"})),e.captions&&(a(".controls").append(h),a(".captionbar").append(e.startImage?"<a href='"+t(v)+"'><span>"+o(v)+"</span></a>":"<a href='"+t(w)+"'><span>"+o(w)+"</span></a>")),e.shadow&&(r.append(g),a(".shadow").delay(200).fadeIn(500)),e.autoplay?s():a(".captionbar").animate({height:"55px"},600,function(){a(".captionbar span").fadeIn(400,function(){a(".captionbar span").css({display:"block"})})})}function s(){a(".captionbar").animate({height:"55px"},600,function(){a(".captionbar span").fadeIn(400,function(){a(".captionbar span").css({display:"block"})})}),"top"===e.progressPosition&&a(".progressbar").css({top:"0"}),a(".progressbar").css({"background-color":e.progressColor,width:0}).delay(200).animate({width:"100%"},8e3,function(){e.captions?a(".captionbar span").fadeOut(400,function(){a(".captionbar").animate({height:"0"},600,function(){e.backwards?p():n()}),a(".progressbar").animate({height:"0"},200,function(){a(".progressbar").removeAttr("style")})}):a(".progressbar").delay(300).animate({height:"0"},200,function(){a(".progressbar").removeAttr("style"),e.backwards?p():n()})}),e.pauseOnHover&&jQuery.queue(a(".progressbar")[0],"fx",function(){jQuery.dequeue(this)})}function o(e){return a(".images img:eq("+e+")").attr("title")}function t(e){return a(".images img:eq("+e+")").attr("data-href")?a(".images img:eq("+e+")").attr("data-href"):""}function i(r,o){if(a(".progressbar").css({"background-color":e.progressColor,width:0}),"fade"===e.effect)a(".images img:eq("+r+")").fadeOut("800"),a(".images img:eq("+o+")").delay(200).fadeIn("1600");else if("slide"===e.effect){var t=a(".images img:eq("+r+")").width();a(".images img").show(),a(".images img:eq("+o+")").css({left:t}),a(".images img:eq("+r+")").animate({left:"-"+t}),a(".images img:eq("+o+")").animate({left:"0"})}e.autoplay&&s()}function n(){a(".captionbar a span").remove(),w===y?(k=b,i(w,k),w=b,k+=1,a(".captionbar a").append("<span>"+o(w)+"</span>")):(k=w+1,i(w,k),w+=1,k+=1,a(".captionbar a").append("<span>"+o(w)+"</span>"))}function p(){a(".captionbar a span").remove(),0===w?(q=y,i(w,q),w=y,q-=1,a(".captionbar a").append("<span>"+o(w)+"</span>")):(i(w,q),w-=1,q-=1,a(".captionbar a").append("<span>"+o(w)+"</span>"))}var c=this,e=a.extend({},a.fn.piSlider.defaults,e),d='<div class="loader"></div>',g=(a("img",this).wrapAll('<div class="images"></div>;'),'<div class="shadow"></div>'),u='<div class="controls" style="z-index:999"></div>',l={left:'<div class="arrow left"></div>',right:'<div class="arrow right"></div>'},f='<div class="progressbar"></div>',h='<div class="captionbar"></div>',m=a(".images img").size(),b=0,y=m-1,v=e.startImage-1,w=b,k=w+1,q=w-1;this.css({width:"1000px",height:"450px",position:"relative",margin:"0 auto 150px"}),e.fullsize&&(e.shadow=!1,this.css({width:"100%",height:"100%",margin:"0",padding:"0"}),a("body, html").css({width:"100%",height:"100%",margin:"0",padding:"0"})),e.startImage&&(w=v),e.loader?(this.prepend(d),a(".loader").fadeIn(800).delay(100).fadeOut(800,function(){r(c)})):r(c),e.pauseOnHover&&this.hover(function(){jQuery.queue(a(".progressbar")[0],"fx",[]),a(".progressbar").stop()},function(){a(".progressbar").delay(200).animate({width:"100%"},8e3,function(){a(".progressbar").delay(300).animate({height:"0"},200,function(){a(".progressbar").removeAttr("style"),n()})}),jQuery.queue(a(".progressbar")[0],"fx",function(){jQuery.dequeue(this)})}),a(document).on("click",".left",function(){a(".progressbar").stop(),e.captions?a(".captionbar span").fadeOut(400,function(){a(".captionbar").animate({height:"0"},600,function(){p()}),a(".progressbar").animate({height:"0"},200,function(){a(".progressbar").removeAttr("style").css({"background-color":e.progressColor,width:0})})}):a(".progressbar").animate({height:"0"},200,function(){p(),a(".progressbar").removeAttr("style").css({"background-color":e.progressColor,width:0})})}),a(document).on("click",".right",function(){a(".progressbar").stop(),e.captions?a(".captionbar span").fadeOut(400,function(){a(".captionbar").animate({height:"0"},600,function(){n()}),a(".progressbar").animate({height:"0"},200,function(){a(".progressbar").removeAttr("style").css({"background-color":e.progressColor,width:0})})}):a(".progressbar").animate({height:"0"},200,function(){n(),a(".progressbar").removeAttr("style").css({"background-color":e.progressColor,width:0})})}),e.keyControlling&&a(document).keyup(function(e){37==e.keyCode?(e.preventDefault(),a(".left").click()):39==e.keyCode?(e.preventDefault(),a(".right").click()):32==e.keyCode&&(c.hasClass("paused")?c.hasClass("paused")&&(c.removeClass("paused"),a(".progressbar").delay(200).animate({width:"100%"},8e3,function(){a(".progressbar").delay(300).animate({height:"0"},200,function(){a(".progressbar").removeAttr("style"),n()})}),jQuery.queue(a(".progressbar")[0],"fx",function(){jQuery.dequeue(this)})):(c.addClass("paused"),jQuery.queue(a(".progressbar")[0],"fx",[]),a(".progressbar").stop()))}),a(document).on("click",".captionbar",function(){alert("Open link!"),a(this).load()})},a.fn.piSlider.defaults={loader:!0,autoplay:!0,loop:!0,backwards:!1,effect:"fade",duration:"8000",keyControlling:!0,pauseOnHover:!1,shadow:!0,fullsize:!1,progressColor:"grey",progressBar:!0,progressPosition:"bottom",progressShadow:!1,arrows:!0,captions:!0,startImage:1}}(jQuery);